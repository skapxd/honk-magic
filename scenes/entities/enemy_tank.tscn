[gd_scene load_steps=4 format=3 uid="uid://enemy_tank_scene"]

[ext_resource type="Script" path="res://scripts/entities/enemy_base.gd" id="1_enemy"]

[sub_resource type="GDScript" id="GDScript_tank"]
script/source = "extends EnemyBase

# =============================================================================
# HONK MAGIC - Enemy Tank
# =============================================================================
# Enemigo tanque: lento, resistente, ataque cuerpo a cuerpo fuerte.

func _setup_entity() -> void:
	super._setup_entity()
	max_hp = 150
	hp = max_hp
	speed = 120.0
	detection_range = 250.0
	attack_range = 60.0
	attack_damage = 20.0
	attack_cooldown = 1.5


func _attack_effect() -> void:
	# Efecto de embestida
	if not is_instance_valid(target):
		return

	var direction := (target.global_position - global_position).normalized()
	var tween := create_tween()
	tween.tween_property(self, \"global_position\", global_position + direction * 20, 0.1)
	tween.tween_property(self, \"global_position\", global_position, 0.1)


func _on_state_changed(old_state: State, new_state: State) -> void:
	# Cambiar color segun estado
	match new_state:
		State.IDLE:
			modulate = Color(1, 1, 1)
		State.CHASE:
			modulate = Color(1, 0.8, 0.8)
		State.ATTACK:
			modulate = Color(1, 0.5, 0.5)
"

[sub_resource type="CircleShape2D" id="CircleShape2D_tank"]
radius = 35.0

[node name="EnemyTank" type="CharacterBody2D"]
collision_layer = 2
collision_mask = 1
script = SubResource("GDScript_tank")
max_hp = 150
speed = 120.0
team = 1
detection_range = 250.0
attack_range = 60.0
attack_damage = 20.0
attack_cooldown = 1.5

[node name="Visual" type="Node2D" parent="."]

[node name="Body" type="Polygon2D" parent="Visual"]
color = Color(0.8, 0.2, 0.2, 1)
polygon = PackedVector2Array(-25, -25, 25, -25, 25, 25, -25, 25)

[node name="HornLeft" type="Polygon2D" parent="Visual"]
color = Color(0.6, 0.15, 0.15, 1)
polygon = PackedVector2Array(-20, -25, -10, -25, -15, -40)

[node name="HornRight" type="Polygon2D" parent="Visual"]
color = Color(0.6, 0.15, 0.15, 1)
polygon = PackedVector2Array(10, -25, 20, -25, 15, -40)

[node name="Eye" type="Polygon2D" parent="Visual"]
position = Vector2(0, -5)
color = Color(1, 1, 0.3, 1)
polygon = PackedVector2Array(-8, -5, 8, -5, 8, 5, -8, 5)

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource("CircleShape2D_tank")
